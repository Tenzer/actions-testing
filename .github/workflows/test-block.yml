---
name: Test block rerunning old workflow runs

on:
  workflow_dispatch:
    inputs:
      delay:
        description: How long to pretend the deploy takes in seconds
        required: true

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}

jobs:
  deploy:
    runs-on: ubuntu-24.04

    steps:
      - name: Check this is the latest workflow run
        id: block-workflow-run
        uses: Tenzer/block-old-workflow-rerun@6336f583842cc61ec54552fd054cb77bc14aa34b
        with:
          fail-on-old-rerun: false

      - name: Deploy allow status
        if: always()
        run: echo The deploy status is ${{ steps.block-workflow-run.outputs.allowed }}

      - name: Deploy
        run: sleep ${{ github.event.inputs.delay }}
